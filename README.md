# 📸 Windows 11 托盘截图工具

一个基于 Electron 的 Windows 11 本地常驻托盘小工具，支持全局快捷键触发自动全屏截图、保存截图与剪贴板内容，并提供浮窗操作界面。

## ✨ 功能特性

- **托盘常驻**：应用在系统托盘常驻运行，无主窗口干扰
- **全局快捷键**：默认 `Ctrl+Shift+X` 触发截图（可在配置中修改）
- **全屏截图**：自动捕获主屏幕内容并保存为 PNG 格式
- **剪贴板保存**：同时读取并保存当前剪贴板文本内容
- **元数据记录**：自动生成包含时间戳、路径、剪贴板内容的 JSON 元数据文件
- **浮窗操作**：截图完成后在鼠标附近弹出操作浮窗
  - 查看截图路径和剪贴板内容摘要
  - 快速打开图片
  - 复制剪贴板文本
  - 打开保存目录

## 🚀 快速开始

### 1. 安装依赖

```bash
npm install
```

### 2. 启动应用

```bash
npm start
```

## 📋 使用说明

### 截图操作

1. 启动应用后，会在系统托盘显示图标
2. 按下快捷键 `Ctrl+Shift+X` 触发截图
3. 截图完成后会在鼠标附近弹出浮窗
4. 在浮窗中可以：
   - 点击"打开图片"查看截图
   - 点击"复制剪贴板文本"将文本复制到剪贴板
   - 点击"打开保存目录"查看所有截图
   - 点击"关闭"关闭浮窗

### 托盘菜单

右键点击托盘图标可以：
- 执行截图操作
- 退出应用

## 📁 文件保存位置

所有截图和元数据文件保存在：

```
C:\Users\<用户名>\AppData\Roaming\screenshot-tray-tool\captures\
```

### 文件命名规则

- **截图文件**：`capture_<日期时间>_<时间戳>.png`
- **元数据文件**：`capture_<日期时间>_<时间戳>.json`

### 元数据格式

```json
{
  "id": 1738483200000,
  "createdAt": "2026-02-02T10:00:00.000Z",
  "imagePath": "C:\\Users\\...\\capture_2026-02-02T10-00-00-000Z_1738483200000.png",
  "clipboardText": "剪贴板文本内容"
}
```

## ⚙️ 配置说明

配置文件位于 [src/main/config.js](src/main/config.js)，可修改以下参数：

- **GLOBAL_SHORTCUT**：全局快捷键（默认 `CommandOrControl+Shift+X`）
- **CAPTURES_DIR_NAME**：保存目录名称
- **FLOAT_WINDOW**：浮窗尺寸和样式配置
- **LOG_LEVEL**：日志级别（debug/info/warn/error）

## 📊 日志系统

应用内置完善的日志记录功能，帮助您调试和优化使用：

### 日志文件位置

日志文件保存在项目根目录的 `logs/` 文件夹：

```
d:\screendemo\logs\
├── app-2026-02-02.log
├── app-2026-02-03.log
└── ...
```

### 日志内容

日志文件记录以下信息：
- ✅ 应用启动和退出事件
- ✅ 截图操作（成功/失败、文件路径、剪贴板内容长度）
- ✅ 用户操作追踪（快捷键触发、托盘菜单点击等）
- ✅ 错误和异常信息（含堆栈跟踪）
- ✅ 配置初始化和资源管理
- ✅ 系统事件和状态变化

### 日志格式

```
[2026-02-02T10:30:45.123Z] [INFO] 应用启动
[2026-02-02T10:30:46.456Z] [INFO] 保存目录: C:\Users\...\captures\
[2026-02-02T10:31:00.789Z] [INFO] 操作: {"operation":"截图成功","timestamp":"2026-02-02T10:31:00.789Z","imagePath":"..."}
```

### 日志级别

在 [src/main/config.js](src/main/config.js) 中可以调整日志级别：

```javascript
LOG_LEVEL: 'info' // 可选值: 'debug' | 'info' | 'warn' | 'error'
```

- `debug` - 详细的调试信息（最详细）
- `info` - 常规操作信息（推荐）
- `warn` - 警告信息
- `error` - 仅错误信息（最简洁）

### 变更日志

项目的所有重要变更记录在 [CHANGELOG.md](CHANGELOG.md) 文件中。

## 🏗️ 项目结构

```
screenshot-tray-tool/
├── src/
│   ├── main/                    # 主进程代码
│   │   ├── index.js            # 应用入口
│   │   ├── config.js           # 配置常量
│   │   ├── logger.js           # 增强日志模块（支持文件输出）
│   │   ├── storage.js          # 存储模块
│   │   ├── capture.js          # 截图模块
│   │   ├── tray.js             # 托盘模块
│   │   ├── shortcut.js         # 快捷键模块
│   │   └── windows/
│   │       └── float.js        # 浮窗管理
│   └── renderer/                # 渲染进程代码
│       └── float.html          # 浮窗页面
├── logs/                        # 日志文件目录（自动生成）
│   └── app-YYYY-MM-DD.log      # 按日期分割的日志文件
├── package.json
├── CHANGELOG.md                 # 项目变更日志
└── README.md
```

## 📝 验证清单

启动应用后，请验证以下功能：

- [ ] 托盘图标是否出现在系统托盘中
- [ ] 右键托盘图标是否显示菜单（截图、退出）
- [ ] 按下 `Ctrl+Shift+X` 是否触发截图
- [ ] 截图后是否在保存目录生成 PNG 文件
- [ ] 截图后是否在保存目录生成对应的 JSON 元数据文件
- [ ] 截图后是否在鼠标附近弹出浮窗
- [ ] 浮窗是否显示截图路径和剪贴板内容摘要
- [ ] 点击"打开图片"是否能打开截图文件
- [ ] 点击"复制剪贴板文本"是否能复制文本
- [ ] 点击"打开保存目录"是否能打开保存文件夹
- [ ] 点击"关闭"是否能关闭浮窗

## 🛠️ 技术栈

- **Electron** - 跨平台桌面应用框架
- **screenshot-desktop** - 屏幕截图库
- **Node.js** - JavaScript 运行时

## 🔧 开发说明

### 日志输出

应用运行时会在控制台输出日志，日志级别可在配置文件中调整。

### 错误处理

应用已内置错误处理机制，出现错误不会导致应用崩溃，错误信息会输出到日志。

### 托盘图标

当前使用占位图标（蓝色方块），生产环境建议替换为实际的 .ico 文件。

修改方法：
1. 准备一个 16x16 或 32x32 的 .ico 文件
2. 在 [src/main/tray.js](src/main/tray.js) 的 `createPlaceholderIcon()` 方法中，使用 `nativeImage.createFromPath()` 加载图标文件

## 🚧 后续扩展方向

- 支持多屏幕截图
- 全屏 overlay 高亮鼠标周边区域
- OCR 文字识别
- 历史截图查看和管理
- 截图编辑功能
- 快捷键自定义界面
- 截图格式选择（JPEG、WebP 等）
- 剪贴板图片/文件支持

## 📄 许可证

MIT License

---

**提示**：首次运行时，Windows 可能会弹出防火墙提示，请允许应用访问网络（尽管本应用不需要网络功能，但 Electron 可能会请求）。
